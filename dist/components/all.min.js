"use strict";angular.module("cossap.catalogue",[]).directive("cossapCatalogue",[function(){return{templateUrl:"components/catalogue/catalogue.html",controller:"cossapCatalogueController"}}]).controller("cossapCatalogueController",["$scope","streamChartService",function(e,t){var r,a,o,n=_viewer.scene.imageryLayers,s=_viewer.canvas;_viewer.scene.globe.ellipsoid;e.demoGraph=function(){t.initChart()},e.demoPoly=function(){_viewer.entities.add({name:"Orange polygon with per-position heights and outline",polygon:{hierarchy:Cesium.Cartesian3.fromDegreesArrayHeights([138,-25,1e5,130,-25,1e5,130,-20,1e5,138,-20,3e5]),extrudedHeight:0,perPositionHeight:!0,material:Cesium.Color.ORANGE.withAlpha(.5),outline:!0,outlineColor:Cesium.Color.BLACK}});_viewer.zoomTo(_viewer.entities)},e.addClickCanvas=function(){s.onclick=function(){console.log("CLICK")}},e.clickHandlerLocation=function(){var e,t=new Cesium.ScreenSpaceEventHandler(s);t.setInputAction(function(t){console.log(t),e=Cesium.Cartesian3.clone(t.position);var r=Cesium.Ellipsoid.WGS84.cartesianToCartographic(e);console.log("Cesium.Cartesian mousePosition "+e),console.log("Cesium.Cartographic mousePosition "+r)},Cesium.ScreenSpaceEventType.LEFT_CLICK)},e.rest=function(){console.log("ArcGis");var e="http://www.ga.gov.au/gis/rest/services/topography/Australian_Topography_WM/MapServer",t="0";return a?(n.remove(a),console.log("removing layer.."),void(a=null)):void(a=n.addImageryProvider(new Cesium.ArcGisMapServerImageryProvider({url:e,layers:t,rectangle:ausExtent})))},e.wms=function(){if(console.log("wms"),r)return n.remove(r),console.log("removing layer.."),void(r=null);var e="https://programs.communications.gov.au/geoserver/ows",t="mybroadband:MyBroadband_ADSL_Availability";r=n.addImageryProvider(new Cesium.WebMapServiceImageryProvider({url:e,layers:t,rectangle:ausExtent,parameters:{transparent:"true",format:"image/png"}})),r.alpha=.6},e.boreholes=function(){if(console.log("boreholes"),o)return n.remove(o),console.log("removing layer.."),void(o=null);var e="http://www.ga.gov.au/borehole-gsmlborehole-gws/ows",t="gsmlp:BoreholeView",r=function(){console.log("CALLBACK.. only fires when no features returned...")};o=n.addImageryProvider(new Cesium.WebMapServiceImageryProvider({url:e,layers:t,rectangle:ausExtent,parameters:{transparent:"true",format:"image/png"},enablePickFeatures:!0,getFeatureInfoFormats:[new Cesium.GetFeatureInfoFormat("json","application/json",r)]})),o.alpha=1}}]),angular.module("cossap.cesiumpanel",[]).controller("CesiumPanelController",["$scope","cossapChartState",function(e,t){e.cossapChartState=t}]),angular.module("cossap.charts.stream",[]).directive("chartStream",[function(){return{templateUrl:"components/charts/chart-stream.html",controller:"streamChartController"}}]).controller("streamChartController",["$scope","cossapChartState",function(e,t){e.cossapChartState=t}]).factory("streamChartService",["$rootScope","cossapChartState",function(e,t){var r={};return r.initChart=function(){if(console.log("initChart.."),t.chartPanel)return t.chartPanel=!1,void $("#streamChartD3").html("");t.chartPanel=!0;var r={top:0,right:100,bottom:30,left:100},a=1e3,o=320-r.top-r.bottom,n=d3.scale.ordinal().rangeRoundBands([0,a],.1),s=d3.scale.linear().rangeRound([o,0]),l=d3.svg.axis().scale(n).orient("bottom"),i=d3.svg.axis().scale(s).orient("left"),c=d3.layout.stack().offset("wiggle").values(function(e){return e.values}).x(function(e){return n(e.label)+n.rangeBand()/2}).y(function(e){return e.value}),u=d3.svg.area().interpolate("cardinal").x(function(e){return n(e.label)+n.rangeBand()/2}).y0(function(e){return s(e.y0)}).y1(function(e){return s(e.y0+e.y)}),p=d3.scale.ordinal().range(["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"]),m=d3.select("#streamChartD3").append("svg").attr("width",a+r.left+r.right).attr("height",o+r.top+r.bottom).append("g").attr("transform","translate("+r.left+","+r.top+")");d3.csv("components/charts/demo.csv",function(e,t){function r(){$(".popover").each(function(){$(this).remove()})}function d(e){$(this).popover({title:e.name,placement:"auto top",container:"body",trigger:"manual",html:!0,content:function(){return"Quarter: "+e.label+"<br/>Rounds: "+d3.format(",")(e.value?e.value:e.y1-e.y0)}}),$(this).popover("show")}console.log(t);var g="quarter",h=d3.keys(t[0]).filter(function(e){return e!==g});p.domain(h);var f=[],v={};h.forEach(function(e){v[e]={name:e,values:[]},f.push(v[e])}),t.forEach(function(e){h.map(function(t){v[t].values.push({name:t,label:e[g],value:+e[t]})})}),n.domain(t.map(function(e){return e.quarter})),c(f),s.domain([0,d3.max(f,function(e){return d3.max(e.values,function(e){return e.y0+e.y})})]),m.append("g").attr("class","x axis").attr("transform","translate(0,"+o+")").call(l),m.append("g").attr("class","y axis").call(i).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").style("fill","#FFF").text("Number of Rounds");var C=m.selectAll(".series").data(f).enter().append("g").attr("class","series");C.append("path").attr("class","streamPath").attr("d",function(e){return u(e.values)}).style("fill",function(e){return p(e.name)}).style("stroke","grey");var y=m.selectAll(".seriesPoints").data(f).enter().append("g").attr("class","seriesPoints");y.selectAll(".point").data(function(e){return e.values}).enter().append("circle").attr("class","point").attr("cx",function(e){return n(e.label)+n.rangeBand()/2}).attr("cy",function(e){return s(e.y0+e.y)}).attr("r","10px").style("fill",function(e){return p(e.name)}).on("mouseover",function(e){d.call(this,e)}).on("mouseout",function(e){r()});var w=m.selectAll(".legend").data(h.slice().reverse()).enter().append("g").attr("class","legend").attr("transform",function(e,t){return"translate(55,"+20*t+")"});w.append("rect").attr("x",a-10).attr("width",10).attr("height",10).style("fill",p).style("stroke","grey"),w.append("text").attr("x",a-12).attr("y",6).attr("dy",".35em").style("text-anchor","end").style("fill","#FFF").text(function(e){return e})}),e.$$phase||e.$apply()},r}]),angular.module("cossap.charts",[]).directive("cossapChartPanel",[function(){return{templateUrl:"components/charts/charts.html",controller:"cossapChartController"}}]).controller("cossapChartController",["$scope","cossapChartState",function(e,t){e.cossapChartState=t}]).factory("cossapChartState",[function(){var e={};return e.chartPanel=!1,e.streamChart=!1,e}]);